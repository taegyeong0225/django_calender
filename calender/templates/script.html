<!-- script -->
<!-- FullCalendar 초기화 -->
<script>
   $(document).ready(function () {
       var calendar = $('#calendar').fullCalendar({
           header: {
               left: 'prev,next today',
               center: 'title',
               right: 'month,listMonth'
           },
           events: '/all_events',
           selectable: true,
           selectHelper: true,
           editable: true,
           eventLimit: true,
       // 날짜를 선택할 때
       select: function (start, end, allDay) {
            var foodName = "";
            var startDate = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
            var endDate = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");

            // 모달 대화 상자 열기
            $("#event-food").val("");
            $("#event-start").val(startDate);
            $("#event-end").val(endDate);
            var category = $("#category").val(); // 카테고리


            $("#event-dialog").dialog({
                title: '이벤트 정보 입력',
                buttons: {
                    '저장': function () {
                        foodName = $("#event-food").val();
                        startDate = $("#event-start").val();
                        endDate = $("#event-end").val();
                        var category = $("#category").val(); // 선택한 카테고리 값 가져오기

                        // 서버로 이벤트 데이터 전송
                        $.ajax({
                            type: "GET",
                            url: '/add_event',
                            data: {'title': foodName, 'start': startDate, 'end': endDate, 'f_category': category}, // 카테고리 정보 추가
                            dataType: "json",
                            success: function (data) {
                                calendar.fullCalendar('refetchEvents');
                                alert("이벤트 등록 완료!");
                                $("#event-dialog").dialog('close');
                            },
                            error: function (data) {
                                alert('문제가 발생하였습니다');
                            }
                        });
                    },
                    '취소': function () {
                        $("#event-dialog").dialog('close');
                    }
                },
                close: function () {
                    // 다이얼로그가 닫힐 때 입력 값 초기화
                    $("#event-food").val("");
                    $("#event-start").val("");
                    $("#event-end").val("");
                },
                modal: true
            });
       },

           eventResize: function (event) {
               var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
               var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
               var title = event.title;
               var id = event.id;
               $.ajax({
                   type: "GET",
                   url: '/update',
                   data: {'title': title, 'start': start, 'end': end, 'id': id},
                   dataType: "json",
                   success: function (data) {
                       calendar.fullCalendar('refetchEvents');
                       alert('Event Update');
                   },
                   error: function (data) {
                       alert('There is a problem!!!');
                   }
               });
           },

           eventDrop: function (event) {
               var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
               var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
               var title = event.title;
               var id = event.id;
               $.ajax({
                   type: "GET",
                   url: '/update',
                   data: {'title': title, 'start': start, 'end': end, 'id': id},
                   dataType: "json",
                   success: function (data) {
                       calendar.fullCalendar('refetchEvents');
                       alert('Event Update');
                   },
                   error: function (data) {
                       alert('There is a problem!!!');
                   }
               });
           },
           // event를 눌렀을 때 -> 삭제
           eventClick: function (event) {
               if (confirm("Are you sure you want to remove it?")) {
                   var id = event.id;
                   $.ajax({
                       type: "GET",
                       url: '/remove',
                       data: {'id': id},
                       dataType: "json",
                       success: function (data) {
                           calendar.fullCalendar('refetchEvents');
                           alert('Event Removed');
                       },
                       error: function (data) {
                           alert('There is a problem!!!');
                       }
                   });
               }
           },

       });
   });

</script>